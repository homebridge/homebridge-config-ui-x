<div class="d-flex justify-content-between">
  <h3 class="primary-text m-0">
    {{ 'menu.settings.title' | translate }}
  </h3>
  <button class="btn btn-primary waves-effect m-0" *ngIf="saved" routerLink="/restart"
    [attr.aria-label]="'platform.docker.settings.button_restart_required' | translate">
    {{ 'platform.docker.settings.button_restart_required' | translate }}
  </button>
</div>

<div class="mb-4">
  <h5 (click)="toggleSection('general')" class="primary-text mt-3 hover-pointer"
    tabindex="0" [attr.aria-expanded]="showFields.general ? 'true' : 'false'">
    <i class="fa fa-fw" [ngClass]="showFields.general ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
    {{ 'settings.general.title_general' | translate }}
  </h5>
  <ul class="list-group list-group-box mt-2 mx-2" *ngIf="showFields.general">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'menu.label_settings_ui' | translate }}
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="openUiSettings()">
        <i class="fas fa-fw fa-sliders"></i>
      </button>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>{{ 'settings.language' | translate }}</span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select class="custom-select resp-select" [ngModel]="$settings.env.lang" (ngModelChange)="onLangChange($event)">
          <option value="auto">Automatic (Use Browser Settings)</option>
          <option value="bg">Bulgarian (bg)</option>
          <option value="ca">Catalan (ca)</option>
          <option value="zh-CN">Chinese - Simplified (zh-CN)</option>
          <option value="zh-TW">Chinese - Traditional (zh-TW)</option>
          <option value="cs">Czech (cs)</option>
          <option value="nl">Dutch (nl)</option>
          <option value="en">English (en)</option>
          <option value="fr">French (fr)</option>
          <option value="de">German (de)</option>
          <option value="he">Hebrew (he)</option>
          <option value="hu">Hungarian (hu)</option>
          <option value="id">Indonesian (id)</option>
          <option value="it">Italian (it)</option>
          <option value="ja">Japanese (ja)</option>
          <option value="ko">Korean (ko)</option>
          <option value="mk">Macedonian (mk)</option>
          <option value="no">Norwegian (no)</option>
          <option value="pl">Polish (pl)</option>
          <option value="pt-BR">Portuguese (Brazil)</option>
          <option value="pt">Portuguese (Portugal)</option>
          <option value="ru">Russian (ru)</option>
          <option value="sl">Slovenian (sl)</option>
          <option value="es">Spanish (es)</option>
          <option value="sv">Swedish (sv)</option>
          <option value="th">Thai (th)</option>
          <option value="tr">Turkish (tr)</option>
          <option value="uk">Ukrainian (uk)</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>{{ 'settings.theme' | translate }}</span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select class="custom-select resp-select" [ngModel]="$settings.theme" (ngModelChange)="onThemeChange($event)">
          <option value="auto">Default (Auto Dark Mode)</option>
          <option value="red">Red</option>
          <option value="pink">Pink</option>
          <option value="purple">Purple</option>
          <option value="deep-purple">Purple - Deep</option>
          <option value="indigo">Indigo</option>
          <option value="blue">Blue</option>
          <option value="navi-blue">Blue - Navi</option>
          <option value="blue-grey">Blue Grey</option>
          <option value="cyan">Cyan</option>
          <option value="green">Green</option>
          <option value="teal">Teal</option>
          <option value="orange">Orange</option>
          <option value="amber">Amber</option>
          <option value="grey">Grey</option>
          <option value="brown">Brown</option>
          <option value="dark-mode">Dark Mode - HomeKit Orange</option>
          <option value="dark-mode-red">Dark Mode - Red</option>
          <option value="dark-mode-pink">Dark Mode - Pink</option>
          <option value="dark-mode-purple">Dark Mode - Purple</option>
          <option value="dark-mode-indigo">Dark Mode - Indigo</option>
          <option value="dark-mode-blue">Dark Mode - Blue</option>
          <option value="dark-mode-blue-grey">Dark Mode - Blue Grey</option>
          <option value="dark-mode-green">Dark Mode - Green</option>
          <option value="dark-mode-grey">Dark Mode - Grey</option>
          <option value="dark-mode-brown">Dark Mode - Brown</option>
          <option value="dark-mode-teal">Dark Mode - Teal</option>
          <option value="dark-mode-cyan">Dark Mode - Cyan</option>
        </select>
      </div>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'backup.title_backup' | translate }}
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="openBackupModal()">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'backup.title_restore' | translate }}
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="openRestoreModal()">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'menu.tooltip_user_accounts' | translate }}
      </span>
      <a class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" routerLink="/users">
        <i class="fas fa-fw fa-chevron-right"></i>
      </a>
    </li>
  </ul>
</div>

<!-- ALL USERS -->
<div class="mb-4">
  <h5 (click)="toggleSection('network')" class="primary-text mt-3 hover-pointer"
    tabindex="0" [attr.aria-expanded]="showFields.network ? 'true' : 'false'">
    <i class="fa fa-fw" [ngClass]="showFields.network ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
    {{ 'settings.network.title_network' | translate }}
  </h5>
  <ul class="list-group list-group-box mt-2 mx-2" *ngIf="showFields.network">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        <div>{{ 'settings.network.title_network_interfaces' | translate }}<br>
          <small class="grey-text pr-2">{{ 'settings.network.message_network_interface' | translate }}</small>
        </div>
        <span *ngFor="let adapter of bridgeNetworkAdapters">
          <span class="badge badge-pill mr-1" [ngClass]="{'badge-danger': adapter.missing, 'badge-info': !adapter.missing}">
            <i class="fas fa-fw fa-exclamation-triangle" *ngIf="adapter.missing"></i>
            {{ adapter.iface }}: <span class="font-weight-normal">{{ adapter.missing ? ('settings.mdns_advertiser_not_connected' | translate) : adapter.ip4 || adapter.ip6 }}</span>
          </span>
        </span>
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="selectNetworkInterfaces()"
        [disabled]="!availableNetworkAdapters.length" [attr.aria-label]="'settings.network.title_network_interfaces' | translate">
        <i class="fas fa-fw fa-chevron-right" [ngClass]="{ 'fa-pulse': !availableNetworkAdapters.length }"></i>
      </button>
    </li>
    <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.mdns_advertiser' | translate }}<br>
        <small class="grey-text pr-2">{{ 'settings.mdns_advertiser_help' | translate }}</small>
      </span>
      <div class="my-3 my-md-0 pl-0 pl-md-5 w-auto">
        <select class="custom-select resp-select" [formControl]="legacyMdnsFormControl"
          [attr.aria-label]="'settings.mdns_advertiser' | translate">
          <option value="bonjour-hap">Bonjour HAP</option>
          <option value="avahi" *ngIf="showAvahiMdnsOption">Avahi</option>
          <option value="resolved" *ngIf="showResolvedMdnsOption">systemd-resolved (experimental)</option>
          <option value="ciao">Ciao</option>
        </select>
      </div>
    </li>
  </ul>
</div>

<!-- SERVICE MODE USERS ONLY -->
<form class="my-4" novalidate [formGroup]="serviceForm" *ngIf="$settings.env.serviceMode">
  <h5 (click)="toggleSection('startup')" class="primary-text mt-3 hover-pointer"
    tabindex="0" [attr.aria-expanded]="showFields.startup ? 'true' : 'false'">
    <i class="fa fa-fw" [ngClass]="showFields.startup ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
    {{ 'settings.title_startup_options' | translate }}
  </h5>
  <ul class="list-group list-group-box mb-4 mx-2" *ngIf="showFields.startup">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>{{ 'settings.startup.debug' | translate }} <code>-D</code></span>
      <input type="checkbox" class="rendux-input" id="homebridgeDebugMode" formControlName="HOMEBRIDGE_DEBUG"
        [attr.aria-label]="'settings.startup.debug' | translate">
      <label for="homebridgeDebugMode" class="rendux-label ml-3" style="min-width: 50px;"></label>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span>
        {{ 'settings.startup.insecure_1' | translate }} ({{ 'settings.startup.insecure_2' | translate }})
        <code>-I</code>
      </span>
      <input type="checkbox" class="rendux-input" id="homebridgeInsecureMode" formControlName="HOMEBRIDGE_INSECURE"
        [attr.aria-label]="'settings.startup.insecure_1' | translate">
      <label for="homebridgeInsecureMode" class="rendux-label ml-3" style="min-width: 50px;"></label>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center" *ngIf="$settings.env.serviceMode">
      <span>{{ 'settings.startup.keep_accessories' | translate }} <code>-K</code></span>
      <input type="checkbox" class="rendux-input" id="homebridgeKeepOrphans" formControlName="HOMEBRIDGE_KEEP_ORPHANS"
        [attr.aria-label]="'settings.startup.keep_accessories' | translate">
      <label for="homebridgeKeepOrphans" class="rendux-label ml-3" style="min-width: 50px;"></label>
    </li>
  </ul>
  <div class="my-4">
    <h5 (click)="toggleSection('env')" class="primary-text mt-3 hover-pointer"
      tabindex="0" [attr.aria-expanded]="showFields.env ? 'true' : 'false'">
      <i class="fa fa-fw" [ngClass]="showFields.env ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
      {{ 'settings.title_environment_variables' | translate }}
    </h5>
    <ul class="list-group list-group-box mt-2 mx-2" *ngIf="showFields.env">
      <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
        <span>
          DEBUG<br>
          <small class="grey-text pr-2">{{ 'settings.service.debug_tooltip' | translate }}</small>
        </span>
        <div class="my-3 my-md-0 pl-0 pl-md-5 w-100" style="max-width:500px!important;">
          <input class="form-control custom-input form-control-sm" formControlName="ENV_DEBUG" type="text" />
        </div>
      </li>
      <li class="list-group-item d-block d-md-flex justify-content-between align-items-center">
        <span>
          NODE_OPTIONS<br>
          <small class="grey-text pr-2">{{ 'settings.service.node_tooltip' | translate }}</small>
        </span>
        <div class="my-3 my-md-0 pl-0 pl-md-5 w-100" style="max-width:500px!important;">
          <input class="form-control custom-input form-control-sm" formControlName="ENV_NODE_OPTIONS" type="text" />
        </div>
      </li>
    </ul>
  </div>
</form>

<!-- ALL USERS -->
<div class="my-4">
  <h5 (click)="toggleSection('reset')" class="primary-text mt-3 hover-pointer"
    tabindex="0" [attr.aria-expanded]="showFields.reset ? 'true' : 'false'">
    <i class="fa fa-fw" [ngClass]="showFields.reset ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
    {{ 'reset.title_reset' | translate }}
  </h5>
  <p class="small grey-text mb-2 mx-2">{{ 'settings.reset.help' | translate }}</p>
  <ul class="list-group list-group-box mt-2 mx-2" *ngIf="showFields.reset">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.title_unpair_bridges_cameras_tv_external_accessories' | translate }}<br/>
        <small class="grey-text pr-2">{{ 'reset.message_unpair_bridges_cameras_tv_external_accessories' | translate }}</small>
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="unpairAccessory()"
        [attr.aria-label]="'reset.title_unpair_bridges_cameras_tv_external_accessories' | translate">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.title_reset_homebridge_accessory' | translate | titlecase }}<br/>
        <small class="grey-text pr-2">{{ 'reset.message_reset_will_unpair_from_homekit' | translate }}</small>
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="resetHomebridgeState()"
        [attr.aria-label]="'reset.title_reset_homebridge_accessory' | translate">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
  </ul>
</div>

<!-- SERVICE MODE USERS ONLY -->
<div *ngIf="$settings.env.serviceMode" class="pb-3">
  <h5 (click)="toggleSection('cache')" class="primary-text mt-3 hover-pointer"
    tabindex="0" [attr.aria-expanded]="showFields.cache ? 'true' : 'false'">
    <i class="fa fa-fw" [ngClass]="showFields.cache ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
    {{ 'settings.title_manage_cached_accessories' | translate }}
  </h5>
  <p class="small grey-text mb-2 mx-2">{{ 'settings.manage_cache.help' | translate }}</p>
  <ul class="list-group list-group-box mb-4 mx-2" *ngIf="showFields.cache">
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.title_clear_cached_accessories_single' | translate }}<br>
        <small class="grey-text pr-2">{{ 'reset.message_remove_cached_accessories_single' | translate }}</small>
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="removeSingleCachedAccessories()"
        [attr.aria-label]="'reset.title_clear_cached_accessories_single' | translate">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <span class="pr-2">
        {{ 'reset.title_clear_cached_accessories' | translate }}<br>
        <small class="grey-text pr-2">{{ 'reset.message_remove_cached_accessories' | translate }}</small>
      </span>
      <button class="btn btn-primary waves-effect m-0 ml-3" style="min-width: 50px;" (click)="removeAllCachedAccessories()"
        [attr.aria-label]="'reset.title_clear_cached_accessories' | translate">
        <i class="fas fa-fw fa-chevron-right"></i>
      </button>
    </li>
  </ul>
</div>
